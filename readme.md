# ESP32 多功能鬧鐘系統 README

本專案是一個基於 **ESP32 + MicroPython** 的多功能智慧鬧鐘系統，整合 Wi‑Fi 連線、AP 設定模式、DHT11 溫濕度感測、OLED 顯示、網頁鬧鐘設定介面與蜂鳴器音樂播放功能。

---

## 系統功能總覽

### 1. Wi-Fi 自動連線
- 讀取 `wifi.txt` 內的 SSID、密碼並嘗試連線
- 連線成功會顯示本機 IP
- 連線失敗時自動進入 AP 設定模式

### 2. Wi-Fi AP 設定模式
- 若沒有 `wifi.txt` 或連線失敗
- ESP32 會建立 AP：
  - SSID: **ESP32_Setup**
  - 密碼: **12345678**
- 使用者可透過 Wi-Fi 進入設定頁輸入 SSID / 密碼
- 儲存後重新啟動即可連線

### 3. 時間同步 (NTP)
- 透過 `ntptime` 自動同步網路時間
- 將時間轉換為台灣時區 (UTC+8)

### 4. OLED 螢幕資訊顯示
螢幕顯示內容：
- Wi-Fi IP 或連線中狀態
- 日期時間
- DHT11 溫濕度
- 已設定之鬧鐘（可按按鈕切換）

### 5. DHT11 感測器
- 每 10 秒自動量測一次溫度與濕度
- 顯示於 OLED 上

### 6. 按鈕功能
- **button (Pin 17)**：鬧鐘停止
- **button_next (Pin 21)**：切換顯示不同鬧鐘

### 7. 蜂鳴器音樂播放
- 使用 PWM 播放 *Twinkle Twinkle Little Star*
- 支援非同步播放、可隨時停止

### 8. 網頁版鬧鐘管理介面
- 可新增鬧鐘（含星期選擇）
- 可刪除鬧鐘
- 自動儲存至 `alarms.json`
- UI 使用行動裝置友善設計

### 9. 鬧鐘觸發與處理
- 每秒檢查是否達到鬧鐘時間
- 若為週期鬧鐘 → 每週指定日響起
- 若為一次性鬧鐘 → 響完後自動停用
- 支援：
  - 手動停止
  - 自動停止（以秒為單位上限）

---

## 系統檔案結構
```
main.py           # 主程式（本程式碼）
wifi.txt          # 儲存 Wi-Fi SSID、Password
alarms.json       # 儲存所有鬧鐘
ssd1306.py        # OLED 驅動程式
```

---

## 硬體需求
- ESP32 開發板 x1
- SSD1306 OLED 顯示器 (I2C)
- DHT11 溫濕度感測器
- 按鈕 x2
- 蜂鳴器（支援 PWM）
- 杜邦線若干

---

## 硬體接腳定義
| 功能 | ESP32 Pin |
|------|-----------|
| OLED SDA | 5 |
| OLED SCL | 7 |
| DHT11 感測器 | 18 |
| 蜂鳴器 PWM | 6 |
| 按鈕 1（停止） | 17 |
| 按鈕 2（切換鬧鐘） | 21 |

---

## 網頁操作介面
連線至：
```
http://<ESP32_IP>/
```
提供功能：
- 新增鬧鐘
- 選擇星期（一~日）
- 刪除既有鬧鐘
- 查看當前設定

---

## 系統運作流程
1. 啟動 ESP32 → 顯示 Initializing
2. 嘗試讀取 Wi-Fi 資訊並連線
3. 若連線成功：
   - 同步 NTP 時間
   - 啟動所有任務：
     - 溫濕度讀取
     - OLED 顯示
     - 鬧鐘檢查
     - WebServer
4. 若連線失敗：
   - 開啟 AP 模式並顯示設定 SSID 介面
5. 使用者連上設定頁輸入 Wi-Fi
6. 重新啟動後自動連線

---

## 鬧鐘行為
- 鬧鐘到時：播放旋律
- 停止條件：
  - 按停止鍵 → 立即停止
  - 超過最大鳴響時間 → 自動停止
- 一次性鬧鐘：響完後自動停用

---

## 注意事項
- 提前準備 `wifi.txt` 或使用 AP 模式設定
- DHT11 量測需避免過快（建議 ≥ 1 秒），本程式設定為 10 秒
- 若 OLED 無顯示，請確認 I2C 接腳是否與程式相符



